# 艦隊分析コード (Fleet Analysis Code) JSON仕様

「艦隊分析ツール」（kc-web等）で利用される「艦隊分析コード」のJSONフォーマットに関するリバースエンジニアリング結果の仕様まとめです。
主に出力（エクスポート）機能および入力（インポート）機能において、ローカルの所持艦娘（ShipStock）および所持装備（ItemStock）を表現するために使用されます。

このコードは通常2つのJSON配列から構成されるか、特定のツールではそれらをプロパティに持つ1つのオブジェクトとして扱われます。基本的には**「艦船データの配列」**と**「装備データの配列」**の2種類が存在します。

---

## 1. 艦娘データ (ShipStock JSON)

ユーザーが所持している艦娘のリストを表現するJSON配列です。配列の各要素は1隻の艦娘を表すオブジェクトです。

### 構成例

```json
[
  {
    "id": 1001,
    "ship_id": 318,
    "lv": 175,
    "st": [10, 5, 0, 0, 84, 2, 0],
    "exp": [1000000, 0, 0],
    "area": 1,
    "ex": 1,
    "sp": []
  },
  ...
]
```

### プロパティ詳細

| キー      | 型         | 説明                                                                                                                                            |
| :-------- | :--------- | :---------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`      | `number`   | ユーザーの艦隊内での固有ID (uniqueId)。艦これAPIでの`api_id`に相当。                                                                            |
| `ship_id` | `number`   | 艦娘のマスタID。艦これAPIでの`api_ship_id`に相当。                                                                                              |
| `lv`      | `number`   | 艦娘のレベル。                                                                                                                                  |
| `st`      | `number[]` | 近代化改修（ステータス上昇値）の配列。インデックス順に以下の7項目:<br>`[0]火力`, `[1]雷装`, `[2]対空`, `[3]装甲`, `[4]運`, `[5]耐久`, `[6]対潜` |
| `exp`     | `number[]` | 経験値情報の配列。インデックス順に以下の3項目:<br>`[0]累積経験値`, `[1]次のレベルまでの経験値`, `[2]経験値バー割合(省略可=0)`                   |
| `area`    | `number`   | 出撃海域（お札）のID。未出撃・札なしの場合は `0`。                                                                                              |
| `ex`      | `number`   | 補強増設の解放状態。解放済みの場合は `1`、未解放の場合は `0`。                                                                                  |
| `sp`      | `number[]` | 特殊アイテム（海色リボン、白たすき等）のID配列。未装備の場合は空配列 `[]`。<br>※`1`=海色リボン, `2`=白たすきなど。                              |

_備考: 初期仕様（v1）では `api_id`, `api_ship_id` などの艦これAPIレスポンスに近い形式が使われていましたが、現在の主要ツールでは上記のような短縮名（v2/v3形式）が主流となっています。_

---

## 2. 装備データ (ItemStock JSON)

ユーザーが所持している装備のリストを表現するJSON配列です。
同一の装備マスタIDかつ同一の改修値であっても、**所持している個数分だけオブジェクトの要素として配列に格納**されます。（例：改修値+0の12.7cm連装砲を5個所持している場合は、要素が5つ積まれます）

### 構成例

```json
[
  {
    "id": 1,
    "lv": 0
  },
  {
    "id": 1,
    "lv": 0
  },
  {
    "id": 2,
    "lv": 10
  },
  ...
]
```

### プロパティ詳細

| キー | 型       | 説明                                                   |
| :--- | :------- | :----------------------------------------------------- |
| `id` | `number` | 装備品のマスタID。艦これAPIの`api_slotitem_id`に相当。 |
| `lv` | `number` | 装備品の改修状態（星の数）。0〜10の値を取る。          |

_備考: 初期仕様では `api_slotitem_id`, `api_level` が使われていました。艦載機熟練度は通常、このレベルの分析コードの出力対象ではなく、デッキビルダー形式（編成データ）などでのみ記述されます。_

---

## (参考) 結合フォーマットについて

共有用のURLなどで全体のデータをやり取りする場合は、以下のようにラップされたオブジェクトが使用されることがあります。

```json
{
  "ships": [...艦娘データ配列...],
  "items": [...装備データ配列...],
  "predeck": { /* デッキビルダー形式データ */ },
  "saveData": "..."
}
```

「分析コードから読み込み」機能を実装する際は、ルート要素が配列なのか、それとも上記のようなラップされたオブジェクト（その中の `ships` 要素）なのかを動的に判別（`Array.isArray()` など）してパースすることで、柔軟な取り込みが可能になります。
